<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Выбор объектов для {{ location }}</title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    .object-item {
      display: block;
      margin: 5px;
    }
  </style>
</head>
<body class="bg-main">
  <div class="container">
    <h2>Выберите объекты для локации: {{ location }}</h2>
    <form id="objectsForm" method="post" action="/add_location">
      <input type="hidden" name="location" value="{{ location }}">
      <input type="hidden" name="data" value="{{ data }}">
      <!-- Скрытое поле для выбранных объектов в виде JSON -->
      <input type="hidden" name="selected_objects" id="selectedObjects" value="[]">
      <div>
        {% for obj in objects %}
          <label class="object-item">
            <input type="checkbox" name="obj" value='{{ obj | tojson | safe }}'>
            {{ obj.name }} ({{ obj.cr_code }})
          </label>
        {% endfor %}
      </div>
      <button type="button" onclick="submitObjects()">Добавить</button>
    </form>
    <br>
    <button onclick="window.history.back()">Назад</button>
    <script>
      function submitObjects() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"][name="obj"]:checked');
        let selected = [];
        checkboxes.forEach(cb => {
          try {
            const obj = JSON.parse(cb.value);
            selected.push(obj);
          } catch (e) {
            console.error(e);
          }
        });
        document.getElementById("selectedObjects").value = JSON.stringify(selected);
        document.getElementById("objectsForm").submit();
      }
    </script>
  </div>
</body>
</html>