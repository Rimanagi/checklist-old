{% extends "base.html" %}
{% block title %}Создать чеклист{% endblock %}
{% block content %}
  <h2 style="margin-top:0;">Создание чеклиста</h2>
  <div class="checklist-content" style="background-color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">
    {% if checklist %}
      {% set colors = ["#FFB6C1", "#FFDEAD", "#E6E6FA", "#F5DEB3", "#FFFACD", "#E0FFFF", "#F0FFF0"] %}
      {% for item in checklist %}
        <div class="location-block" style="background-color: {{ colors[loop.index0 % colors|length] }}; border-radius: 8px; padding: 10px; margin-bottom: 10px;">
          <div class="location-header" style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">Локация: {{ item.location }}</div>
          <ul>
            {% for obj in item.objects %}
              <li>{{ obj.name }} ({{ obj.cr_code }})</li>
            {% endfor %}
          </ul>
          <div style="margin-top: 10px;">
            <a href="/edit_location?index={{ loop.index0 }}&data={{ data | urlencode }}{% if checklist_id %}&checklist_id={{ checklist_id }}{% endif %}" style="padding: 8px 12px; background-color: #007bff; color: white; border: none; border-radius: 8px; text-decoration: none; margin-right: 5px;">Редактировать</a>
            <a href="/delete_location?index={{ loop.index0 }}&data={{ data | urlencode }}{% if checklist_id %}&checklist_id={{ checklist_id }}{% endif %}" style="padding: 8px 12px; background-color: #dc3545; color: white; border: none; border-radius: 8px; text-decoration: none;">Удалить</a>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>Чеклист пуст. Добавьте локацию.</p>
    {% endif %}
  </div>
  <div class="checklist-actions" style="background-color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <button onclick="window.location.href='/select_location?data={{ data | urlencode }}{% if checklist_id %}&checklist_id={{ checklist_id }}{% endif %}'" style="padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 8px; margin-right: 10px;">Добавить локацию</button>
    <!-- Форма сохранения чеклиста с выбором пользователя -->
    <form method="post" action="/save_checklist" style="display: inline;">
      <input type="hidden" name="data" value="{{ data }}">
      <input type="hidden" name="checklist_id" value="{{ checklist_id }}">
      <div style="margin-bottom: 10px;">
        <label for="selected_user"><strong>Выберите пользователя:</strong></label>
        <select name="selected_user" id="selected_user" required>
          <option value="">-- Выберите пользователя --</option>
          {% for user in users %}
            <option value="{{ user.username }}" {% if user.username == selected_user %}selected{% endif %}>
              {{ user.username }}
            </option>
          {% endfor %}
        </select>
      </div>
      <button type="submit" style="padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 8px;">Сохранить чеклист</button>
    </form>
  </div>
{% endblock %}